================================================================================
                    TALLY DATABASE LOADER - VISUAL SCHEMA DIAGRAM
================================================================================

                             MULTI-COMPANY CONTEXT
                             ======================
- All tables include: company_id, division_id
- Foreign keys:
  - company_id → mst_company.company_id
  - division_id → mst_division.division_id (and mst_division.company_id → mst_company.company_id)

┌─────────────────────────────────────────────────────────────────────────────┐
│                              MST_COMPANY                                    │
│  ┌─────────────────┐                                                       │
│  │ company_id (PK) │  │ company_name                                      │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              MST_DIVISION                                   │
│  ┌─────────────────┐  ┌─────────────────┐                                   │
│  │ division_id (PK)│  │ company_id (FK) │                                   │
│  │ division_name   │  │ tally_url       │                                   │
│  └─────────────────┘  └─────────────────┘                                   │
└─────────────────────────────────────────────────────────────────────────────┘

                              MASTER DATA HIERARCHY
                              =====================

┌─────────────────────────────────────────────────────────────────────────────┐
│                              CONFIG                                         │
│  ┌─────────────────┐                                                       │
│  │ name (PK)       │ ← System configuration and metadata                   │
│  │ value           │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              MST_GROUP                                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │ guid            │  │ name            │  │ parent          │             │
│  │ name            │  │ primary_group   │  │ is_revenue      │             │
│  │ parent          │  │ is_deemedpositive│  │ affects_gross_profit│        │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│           │                                                                 │
│           │ (self-reference)                                                │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Groups form     │ ← Hierarchical chart of accounts groups               │
│  │ tree structure  │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              MST_LEDGER                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │ guid            │  │ name            │  │ parent          │             │
│  │ name            │  │ opening_balance │  │ closing_balance │             │
│  │ parent          │  │ gstn            │  │ bank_account_*  │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│           │                                                                 │
│           │ parent → mst_group.name                                         │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Individual      │ ← Chart of accounts (customers, suppliers, etc.)      │
│  │ ledger accounts │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

                              INVENTORY HIERARCHY
                              ===================

┌─────────────────────────────────────────────────────────────────────────────┐
│                           MST_STOCK_GROUP                                   │
│  ┌─────────────────┐  ┌─────────────────┐                                 │
│  │ guid            │  │ name            │                                 │
│  │ name            │  │ parent          │                                 │
│  │ parent          │  │                 │                                 │
│  └─────────────────┘  └─────────────────┘                                 │
│           │                                                                 │
│           │ (self-reference)                                                │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Stock groups    │ ← Hierarchical inventory grouping                     │
│  │ (Raw Materials, │                                                       │
│  │  Finished Goods)│                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           MST_STOCK_ITEM                                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │ guid            │  │ name            │  │ parent          │             │
│  │ name            │  │ uom             │  │ opening_balance │             │
│  │ parent          │  │ closing_balance │  │ gst_hsn_code    │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│           │                                                                 │
│           │ parent → mst_stock_group.name                                   │
│           │ uom → mst_uom.name                                              │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Individual      │ ← Stock items with specifications                     │
│  │ stock items     │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

                              WAREHOUSE STRUCTURE
                              ===================

┌─────────────────────────────────────────────────────────────────────────────┐
│                              MST_GODOWN                                     │
│  ┌─────────────────┐  ┌─────────────────┐                                 │
│  │ guid            │  │ name            │                                 │
│  │ name            │  │ parent          │                                 │
│  │ parent          │  │ address         │                                 │
│  └─────────────────┘  └─────────────────┘                                 │
│           │                                                                 │
│           │ (self-reference)                                                │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Warehouses/     │ ← Physical storage locations                          │
│  │ Locations       │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

                              VOUCHER STRUCTURE
                              =================

┌─────────────────────────────────────────────────────────────────────────────┐
│                              TRN_VOUCHER                                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │ guid            │  │ date            │  │ voucher_type    │             │
│  │ date            │  │ voucher_number  │  │ party_name      │             │
│  │ voucher_type    │  │ narration       │  │ is_invoice      │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│           │                                                                 │
│           │ voucher_type → mst_vouchertype.name                             │
│           │ party_name → mst_ledger.name                                    │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Transaction     │ ← Main voucher header (Sales, Purchase, etc.)         │
│  │ Header          │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    │                   │                   │
                    ▼                   ▼                   ▼
┌─────────────────────────┐ ┌─────────────────────────┐ ┌─────────────────────────┐
│    TRN_ACCOUNTING       │ │    TRN_INVENTORY        │ │     TRN_BATCH           │
│ ┌─────────────────────┐ │ │ ┌─────────────────────┐ │ │ ┌─────────────────────┐ │
│ │ guid                │ │ │ │ guid                │ │ │ │ guid                │ │
│ │ ledger              │ │ │ │ item                │ │ │ │ item                │ │
│ │ amount              │ │ │ │ quantity            │ │ │ │ name                │ │
│ │ amount_forex        │ │ │ │ rate                │ │ │ │ quantity            │ │
│ └─────────────────────┘ │ │ │ amount              │ │ │ │ amount              │ │
│                         │ │ │ godown              │ │ │ │ godown              │ │
│ guid → trn_voucher.guid │ │ └─────────────────────┘ │ │ └─────────────────────┘ │
│ ledger → mst_ledger.name│ │                         │ │                         │
│                         │ │ guid → trn_voucher.guid │ │ guid → trn_voucher.guid │
│ Double-entry accounting │ │ item → mst_stock_item   │ │ item → mst_stock_item   │
│ entries                 │ │ godown → mst_godown     │ │ godown → mst_godown     │
└─────────────────────────┘ │                         │ │                         │
                            │ Stock movement entries  │ │ Batch-wise tracking     │
                            └─────────────────────────┘ └─────────────────────────┘

                              COST ALLOCATION
                              ===============

┌─────────────────────────────────────────────────────────────────────────────┐
│                           MST_COST_CATEGORY                                 │
│  ┌─────────────────┐  ┌─────────────────┐                                 │
│  │ guid            │  │ name            │                                 │
│  │ name            │  │ allocate_revenue│                                 │
│  │ allocate_revenue│  │ allocate_non_   │                                 │
│  └─────────────────┘  │ revenue         │                                 │
│           │            └─────────────────┘                                 │
│           │                                                                 │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Cost Categories │ ← Revenue/Non-revenue allocation categories            │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           MST_COST_CENTRE                                   │
│  ┌─────────────────┐  ┌─────────────────┐                                 │
│  │ guid            │  │ name            │                                 │
│  │ name            │  │ parent          │                                 │
│  │ parent          │  │ category        │                                 │
│  └─────────────────┘  └─────────────────┘                                 │
│           │                                                                 │
│           │ parent → mst_cost_category.name                                 │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Cost Centers    │ ← Departments, Projects, etc.                         │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    │                   │                   │
                    ▼                   ▼                   ▼
┌─────────────────────────┐ ┌─────────────────────────┐ ┌─────────────────────────┐
│    TRN_COST_CENTRE                                   │ │    TRN_COST_CATEGORY_CENTRE                                   │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │ guid            │  │ ledger          │  │ costcategory     │             │
│  │ ledger          │  │ costcategory    │  │ costcentre      │             │
│  │ costcentre      │  │ amount          │  │ amount          │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│           │                                                                 │
│           │ guid → trn_voucher.guid                                         │
│           │ ledger → mst_ledger.name                                        │
│           │ costcategory → mst_cost_category.name                            │
│           │ costcentre → mst_cost_centre.name                                │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Category-centre │ ← Allocation by category and centre                    │
│  │ allocation      │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│           TRN_COST_INVENTORY_CATEGORY_CENTRE                                │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────┐ │
│  │ guid            │  │ ledger          │  │ item            │  │ costcat │ │
│  │ ledger          │  │ item            │  │ costcategory    │  │ costcen │ │
│  │ item            │  │ costcentre      │  │ costcentre      │  │ amount  │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────┘ │
│           │                                                                 │
│           │ guid → trn_voucher.guid                                         │
│           │ ledger → mst_ledger.name                                        │
│           │ item → mst_stock_item.name                                      │
│           │ costcategory → mst_cost_category.name                            │
│           │ costcentre → mst_cost_centre.name                                │
│           ▼                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │ Item-category-centre allocation                                      │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘

                              PAYROLL STRUCTURE
                              =================

┌─────────────────────────────────────────────────────────────────────────────┐
│                           MST_EMPLOYEE                                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │ guid            │  │ name            │  │ parent          │             │
│  │ name            │  │ id_number       │  │ date_of_joining │             │
│  │ parent          │  │ pan             │  │ uan             │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│           │                                                                 │
│           │ parent → mst_cost_category.name                                 │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Employee Master │ ← Employee information for payroll                    │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           MST_PAYHEAD                                       │
│  ┌─────────────────┐  ┌─────────────────┐                                 │
│  │ guid            │  │ name            │                                 │
│  │ name            │  │ parent          │                                 │
│  │ parent          │  │ pay_type        │                                 │
│  └─────────────────┘  └─────────────────┘                                 │
│           │                                                                 │
│           │ parent → mst_ledger.name                                        │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Payroll         │ ← Payroll components (Basic, DA, HRA, etc.)          │
│  │ Components      │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    │                   │                   │
                    ▼                   ▼                   ▼
┌─────────────────────────┐ ┌─────────────────────────┐ ┌─────────────────────────┐
│    TRN_EMPLOYEE         │ │    TRN_PAYHEAD          │ │   TRN_ATTENDANCE        │
│ ┌─────────────────────┐ │ │ ┌─────────────────────┐ │ │ ┌─────────────────────┐ │
│ │ guid                │ │ │ │ guid                │ │ │ │ guid                │ │
│ │ category            │ │ │ │ category            │ │ │ │ employee_name       │ │
│ │ employee_name       │ │ │ │ employee_name       │ │ │ │ attendancetype_name │ │
│ │ amount              │ │ │ │ payhead_name        │ │ │ │ time_value          │ │
│ └─────────────────────┘ │ │ │ amount              │ │ │ │ type_value          │ │
│                         │ │ └─────────────────────┘ │ │ └─────────────────────┘ │
│ guid → trn_voucher.guid │ │                         │ │                         │
│ category → mst_cost_    │ │ guid → trn_voucher.guid │ │ guid → trn_voucher.guid │
│ category.name           │ │ category → mst_cost_    │ │ employee_name →        │
│ employee_name →         │ │ category.name           │ │ mst_employee.name      │
│ mst_employee.name       │ │ employee_name →         │ │ mst_attendance_type    │
│                         │ │ mst_employee.name       │ │ mst_payhead.name        │
│ Employee-wise           │ │ payhead_name →          │ │                         │
│ allocation              │ │ mst_payhead.name        │ │ Attendance tracking    │
└─────────────────────────┘ │                         │ └─────────────────────────┘
                            │ Payroll transactions    │
                            └─────────────────────────┘

                              BILL TRACKING
                              =============

┌─────────────────────────────────────────────────────────────────────────────┐
│                              TRN_BILL                                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │ guid            │  │ ledger          │  │ name            │             │
│  │ ledger          │  │ name            │  │ amount          │             │
│  │ name            │  │ amount          │  │ billtype        │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│           │                                                                 │
│           │ guid → trn_voucher.guid                                         │
│           │ ledger → mst_ledger.name                                        │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Bill-wise       │ ← Bill tracking for receivables/payables              │
│  │ tracking        │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

                              BANKING
                              =======

┌─────────────────────────────────────────────────────────────────────────────┐
│                              TRN_BANK                                       │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────┐ │
│  │ guid            │  │ ledger          │  │ transaction_type│  │ dates   │ │
│  │ ledger          │  │ _ledger         │  │ instrument_no   │  │ inst/   │ │
│  │ transaction_type│  │ bank_name       │  │ amount          │  │ bankers │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────┘ │
│           │                                                                 │
│           │ guid → trn_voucher.guid                                         │
│           │ ledger → mst_ledger.name                                        │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Banking         │ ← Cheques/DDs, instrument_date, bankers_date          │
│  │ transactions    │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                      TRN_INVENTORY_ACCOUNTING                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────────────────────┐ │
│  │ guid            │  │ ledger          │  │ additional_allocation_type   │ │
│  │ ledger          │  │ amount          │  │                              │ │
│  └─────────────────┘  └─────────────────┘  └──────────────────────────────┘ │
│           │                                                                 │
│           │ guid → trn_voucher.guid                                         │
│           │ ledger → mst_ledger.name                                        │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Voucher-level   │ ← Inventory additional allocations                     │
│  │ allocations     │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

                              DERIVED TABLES
                              ==============

┌─────────────────────────────────────────────────────────────────────────────┐
│                        MST_ATTENDANCE_TYPE                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────────────────────┐ │
│  │ guid            │  │ name            │  │ attendance_type/period       │ │
│  │ parent          │  │ uom/_uom        │  │                              │ │
│  └─────────────────┘  └─────────────────┘  └──────────────────────────────┘ │
│           │                                                                 │
│           │ parent → mst_attendance_type.name                               │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Attendance type │ ← Payroll attendance types                            │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        MST_GST_EFFECTIVE_RATE                              │
│  ┌─────────────────┐  ┌─────────────────┐                                 │
│  │ item/_item      │  │ applicable_from │                                 │
│  │ hsn_desc/code   │  │ rate            │                                 │
│  │ supply/taxablty │  │ rcm, nature_*   │                                 │
│  └─────────────────┘  └─────────────────┘                                 │
│           │                                                                 │
│           │ item → mst_stock_item.name                                      │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ GST rates       │ ← Effective GST rates for items                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                 MST_STOCKITEM_STANDARD_COST / PRICE                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌──────────────────────────────┐ │
│  │ item/_item      │  │ date            │  │ rate                         │ │
│  └─────────────────┘  └─────────────────┘  └──────────────────────────────┘ │
│           │                                                                 │
│           │ item → mst_stock_item.name                                      │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Standard cost & │ ← Historical standard cost and price                  │
│  │ price           │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                      MST_OPENING_BATCH_ALLOCATION                          │
│  ┌─────────────────┐  ┌─────────────────┐                                 │
│  │ name            │  │ item            │                                 │
│  │ item            │  │ opening_balance │                                 │
│  │ opening_balance │  │ opening_rate    │                                 │
│  └─────────────────┘  └─────────────────┘                                 │
│           │                                                                 │
│           │ item → mst_stock_item.name                                      │
│           │ godown → mst_godown.name                                        │
│           ▼                                                                 │
│  ┌─────────────────┐                                                       │
│  │ Opening stock   │ ← Opening stock batch details                         │
│  │ batches         │                                                       │
│  └─────────────────┘                                                       │
└─────────────────────────────────────────────────────────────────────────────┘

                              RELATIONSHIP SUMMARY
                              ====================

KEY RELATIONSHIP PATTERNS:

1. HIERARCHICAL (Self-referencing):
   ┌─────────────┐    parent    ┌─────────────┐
   │ mst_group   │ ────────────▶│ mst_group   │
   │ (child)     │              │ (parent)    │
   └─────────────┘              └─────────────┘

2. MASTER-DETAIL:
   ┌─────────────┐    parent    ┌─────────────┐
   │ mst_ledger  │ ────────────▶│ mst_group   │
   └─────────────┘              └─────────────┘

3. TRANSACTION-HEADER:
   ┌─────────────┐    guid      ┌─────────────┐
   │ trn_voucher │ ◀───────────│ trn_accounting│
   │ (header)    │              │ (detail)    │
   └─────────────┘              └─────────────┘

4. NAME-BASED REFERENCES:
   ┌─────────────┐    ledger    ┌─────────────┐
   │ trn_accounting│ ──────────▶│ mst_ledger  │
   │ (name)      │              │ (name)      │
   └─────────────┘              └─────────────┘

5. GUID-BASED REFERENCES (Incremental):
   ┌─────────────┐    _ledger   ┌─────────────┐
   │ trn_accounting│ ──────────▶│ mst_ledger  │
   │ (guid)      │              │ (guid)      │
   └─────────────┘              └─────────────┘

================================================================================
                              DATA FLOW
                              =========

TALLY ERP → YAML CONFIG → CSV EXPORT → DATABASE TABLES

1. Tally ERP stores data in proprietary format
2. YAML configuration defines field mappings
3. Data extracted to CSV files
4. CSV data loaded into database tables
5. Relationships maintained through name/GUID references

================================================================================
                              INCREMENTAL SYNC
                              ================

┌─────────────────┐    AlterID    ┌─────────────────┐
│ Tally ERP       │ ────────────▶│ Database        │
│ (Source)        │               │ (Target)        │
└─────────────────┘               └─────────────────┘
        │                                 │
        │ Last AlterID                    │ Last AlterID
        ▼                                 ▼
┌─────────────────┐               ┌─────────────────┐
│ Master: 12345   │               │ Master: 12340   │
│ Trans: 67890    │               │ Trans: 67885    │
└─────────────────┘               └─────────────────┘
        │                                 │
        │ Compare & Sync Only Changes     │
        ▼                                 ▼
┌─────────────────┐               ┌─────────────────┐
│ Changed Records │ ────────────▶│ Updated Tables  │
└─────────────────┘               └─────────────────┘

================================================================================
                              CONCLUSION
                              ==========

The Tally Database Loader creates a comprehensive relational structure that:

1. Preserves all Tally ERP data relationships
2. Maintains data integrity through GUID-based references
3. Supports both full and incremental synchronization
4. Enables powerful reporting and analytics
5. Provides flexible data access patterns

The absence of foreign key constraints allows for:
- Easier data migration
- Flexible relationship management
- Incremental synchronization
- Better performance during bulk operations

This design successfully bridges Tally's proprietary format with standard 
relational database structures while maintaining complete business logic 
and transaction history.
